<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consult√≥rio Olharys - Agendamento</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --background: #f3f4f6;
            --text: #1f2937;
            --white: #ffffff;
            --error: #ef4444;
            --success: #10b981;
            --disabled: #9ca3af;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
        }

        header {
            background-color: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        header h1 {
            color: var(--primary);
            font-size: 1.8rem;
        }

        main {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .step-container {
            background: var(--white);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            display: none; /* Escondido por padr√£o */
            animation: fadeIn 0.5s ease-in-out;
        }

        .step-container.active {
            display: block;
        }

        h2 {
            margin-bottom: 1.5rem;
            color: var(--secondary);
            border-bottom: 2px solid var(--background);
            padding-bottom: 0.5rem;
        }

        /* Passo 1: Sele√ß√£o de Servi√ßo */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .card {
            border: 2px solid var(--background);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .card.selected {
            border-color: var(--primary);
            background-color: #eff6ff;
        }

        .price {
            display: block;
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--primary);
            margin-top: 0.5rem;
        }

        /* Passo 2: Calend√°rio e Hor√°rios */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input[type="date"], input[type="text"], input[type="tel"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 1rem;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .time-slot {
            padding: 0.5rem;
            background: var(--white);
            border: 1px solid var(--primary);
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            color: var(--primary);
            font-weight: 600;
        }

        .time-slot:hover {
            background: var(--primary);
            color: var(--white);
        }

        .time-slot.selected {
            background: var(--primary);
            color: var(--white);
            box-shadow: 0 0 0 2px var(--secondary);
        }

        .time-slot.disabled {
            background-color: #e5e7eb;
            border-color: #d1d5db;
            color: var(--disabled);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Bot√µes */
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background 0.2s;
        }

        .btn-next {
            background-color: var(--success);
            color: var(--white);
        }
        
        .btn-next:hover {
            background-color: #059669;
        }

        .btn-back {
            background-color: #9ca3af;
            color: var(--white);
        }

        /* Mensagens de Erro */
        .error-msg {
            color: var(--error);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Resumo final */
        .summary-box {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }
        .summary-item {
            margin-bottom: 0.5rem;
        }
        .summary-label {
            font-weight: bold;
            color: var(--secondary);
        }

    </style>
</head>
<body>

<header>
    <h1>Consult√≥rio Olharys</h1>
    <p>Excel√™ncia em vis√£o</p>
</header>

<main>
    <div id="step1" class="step-container active">
        <h2>1. Escolha o Profissional</h2>
        <div class="service-grid">
            <div class="card" onclick="selectService('Optometrista', 120, this)">
                <h3>Optometrista</h3>
                <p>Exame de vista completo</p>
                <span class="price">A partir de R$ 120,00</span>
            </div>
            <div class="card" onclick="selectService('Oftalmologista', 150, this)">
                <h3>Oftalmologista</h3>
                <p>Sa√∫de ocular e diagn√≥sticos</p>
                <span class="price">A partir de R$ 150,00</span>
            </div>
        </div>
        <div class="error-msg" id="error-step1">Por favor, selecione um profissional.</div>
        <div class="btn-group" style="justify-content: flex-end;">
            <button class="btn-next" onclick="goToStep(2)">Continuar</button>
        </div>
    </div>

    <div id="step2" class="step-container">
        <h2>2. Data e Hor√°rio (2026)</h2>
        <div class="form-group">
            <label for="dateInput">Selecione uma data:</label>
            <input type="date" id="dateInput" min="2026-01-01" max="2026-12-31">
            <div class="error-msg" id="date-error"></div>
        </div>

        <div id="timeContainer" style="display:none;">
            <label>Hor√°rios dispon√≠veis:</label>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 0.5rem;">Atendimento das 08:00 √†s 18:00 (Almo√ßo 12:00-14:00)</p>
            <div class="time-grid" id="timeGrid">
                </div>
            <div class="error-msg" id="time-error">Selecione um hor√°rio.</div>
        </div>

        <div class="btn-group">
            <button class="btn-back" onclick="goToStep(1)">Voltar</button>
            <button class="btn-next" onclick="goToStep(3)">Continuar</button>
        </div>
    </div>

    <div id="step3" class="step-container">
        <h2>3. Seus Dados</h2>
        
        <div class="summary-box">
            <div class="summary-item"><span class="summary-label">Profissional:</span> <span id="sum-pro"></span></div>
            <div class="summary-item"><span class="summary-label">Data:</span> <span id="sum-date"></span></div>
            <div class="summary-item"><span class="summary-label">Hor√°rio:</span> <span id="sum-time"></span></div>
            <div class="summary-item"><span class="summary-label">Valor:</span> <span id="sum-price"></span></div>
        </div>

        <div class="form-group">
            <label for="name">Nome Completo</label>
            <input type="text" id="name" placeholder="Digite seu nome">
        </div>
        <div class="form-group">
            <label for="city">Cidade</label>
            <input type="text" id="city" placeholder="Sua cidade">
        </div>
        <div class="form-group">
            <label for="phone">Telefone (WhatsApp)</label>
            <input type="tel" id="phone" placeholder="(XX) XXXXX-XXXX">
        </div>

        <div class="error-msg" id="form-error">Preencha todos os campos corretamente.</div>

        <div class="btn-group">
            <button class="btn-back" onclick="goToStep(2)">Voltar</button>
            <button class="btn-next" onclick="finishBooking()">Concluir Agendamento</button>
        </div>
    </div>
</main>

<script>
    // --- Configura√ß√µes e Dados ---
    const WHATSAPP_NUMBER = "5544991837620"; // C√≥digo pa√≠s + DDD + N√∫mero
    const YEAR = 2026;
    
    // Feriados Nacionais 2026 (Formato YYYY-MM-DD)
    const HOLIDAYS_2026 = [
        "2026-01-01", // Confraterniza√ß√£o Universal
        "2026-02-17", // Carnaval (Opcional, mas comum fechar)
        "2026-04-03", // Sexta-feira Santa
        "2026-04-21", // Tiradentes
        "2026-05-01", // Dia do Trabalho
        "2026-06-04", // Corpus Christi
        "2026-09-07", // Independ√™ncia do Brasil
        "2026-10-12", // Nossa Sra. Aparecida
        "2026-11-02", // Finados
        "2026-11-15", // Proclama√ß√£o da Rep√∫blica
        "2026-12-25"  // Natal
    ];

    // Estado da aplica√ß√£o
    let bookingData = {
        service: null,
        price: null,
        date: null,
        time: null,
        patientName: null,
        city: null,
        phone: null
    };

    // --- L√≥gica de Inicializa√ß√£o ---
    document.addEventListener('DOMContentLoaded', () => {
        // Define limites do input date
        const dateInput = document.getElementById('dateInput');
        dateInput.min = `${YEAR}-01-01`;
        dateInput.max = `${YEAR}-12-31`;

        dateInput.addEventListener('change', handleDateChange);
    });

    // --- Navega√ß√£o entre Passos ---
    function goToStep(stepNumber) {
        // Valida√ß√µes antes de avan√ßar
        if (stepNumber === 2) {
            if (!bookingData.service) {
                document.getElementById('error-step1').style.display = 'block';
                return;
            }
            document.getElementById('error-step1').style.display = 'none';
        }

        if (stepNumber === 3) {
            if (!bookingData.date || !bookingData.time) {
                alert("Por favor, selecione data e hor√°rio v√°lidos.");
                return;
            }
            updateSummary();
        }

        // Troca de abas
        document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
        document.getElementById(`step${stepNumber}`).classList.add('active');
    }

    // --- Passo 1: Sele√ß√£o de Servi√ßo ---
    function selectService(name, price, element) {
        bookingData.service = name;
        bookingData.price = price;
        
        // Visual
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
        element.classList.add('selected');
        
        // Resetar hor√°rio se mudar servi√ßo (pois os slots dependem do profissional)
        bookingData.time = null;
        renderTimeSlots(); 
    }

    // --- Passo 2: L√≥gica de Calend√°rio ---
    function handleDateChange(e) {
        const selectedDate = e.target.value;
        const dateObj = new Date(selectedDate + 'T00:00:00'); // T00:00 para evitar timezone issues locais
        const dayOfWeek = dateObj.getDay(); // 0 = Dom, 6 = Sab
        const errorDiv = document.getElementById('date-error');
        const timeContainer = document.getElementById('timeContainer');

        bookingData.date = null;
        timeContainer.style.display = 'none';
        errorDiv.style.display = 'none';
        errorDiv.innerText = '';

        // 1. Validar Ano
        if (dateObj.getFullYear() !== YEAR) {
            errorDiv.innerText = "Agendamentos permitidos apenas para 2026.";
            errorDiv.style.display = 'block';
            return;
        }

        // 2. Validar Fim de Semana
        if (dayOfWeek === 0 || dayOfWeek === 6) {
            errorDiv.innerText = "N√£o atendemos aos s√°bados e domingos.";
            errorDiv.style.display = 'block';
            return;
        }

        // 3. Validar Feriados
        if (HOLIDAYS_2026.includes(selectedDate)) {
            errorDiv.innerText = "N√£o haver√° atendimento neste feriado nacional.";
            errorDiv.style.display = 'block';
            return;
        }

        // Data v√°lida
        bookingData.date = selectedDate;
        timeContainer.style.display = 'block';
        renderTimeSlots();
    }

    function renderTimeSlots() {
        if (!bookingData.date || !bookingData.service) return;

        const grid = document.getElementById('timeGrid');
        grid.innerHTML = '';
        
        // Gerar hor√°rios: 08:00 as 17:00 (√∫ltima consulta come√ßa as 17h p/ acabar as 18h)
        // Almo√ßo: 12:00 as 14:00 (bloqueia slots das 12h e 13h)
        const slots = [
            "08:00", "09:00", "10:00", "11:00", 
            // 12 e 13 almo√ßo
            "14:00", "15:00", "16:00", "17:00"
        ];

        // Recuperar agendamentos j√° feitos do LocalStorage
        // Chave storage: "2026-05-10_Optometrista"
        const storageKey = `${bookingData.date}_${bookingData.service}`;
        const takenSlots = JSON.parse(localStorage.getItem(storageKey)) || [];

        slots.forEach(time => {
            const div = document.createElement('div');
            div.className = 'time-slot';
            div.innerText = time;

            if (takenSlots.includes(time)) {
                div.classList.add('disabled');
                div.title = "Hor√°rio indispon√≠vel";
            } else {
                div.onclick = () => selectTime(time, div);
            }

            grid.appendChild(div);
        });
    }

    function selectTime(time, element) {
        if (element.classList.contains('disabled')) return;

        bookingData.time = time;

        // Visual
        document.querySelectorAll('.time-slot').forEach(t => t.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('time-error').style.display = 'none';
    }

    // --- Passo 3: Finaliza√ß√£o ---
    function updateSummary() {
        // Formatar data para exibi√ß√£o brasileira
        const [ano, mes, dia] = bookingData.date.split('-');
        const dataFormatada = `${dia}/${mes}/${ano}`;

        document.getElementById('sum-pro').innerText = bookingData.service;
        document.getElementById('sum-date').innerText = dataFormatada;
        document.getElementById('sum-time').innerText = bookingData.time;
        document.getElementById('sum-price').innerText = `R$ ${bookingData.price},00`;
    }

    function finishBooking() {
        const name = document.getElementById('name').value.trim();
        const city = document.getElementById('city').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const errorDiv = document.getElementById('form-error');

        if (!name || !city || !phone) {
            errorDiv.style.display = 'block';
            return;
        }

        if (confirm(`Confirma o agendamento para ${bookingData.date} √†s ${bookingData.time}?`)) {
            
            // 1. Salvar Bloqueio no LocalStorage (Simulando Backend)
            const storageKey = `${bookingData.date}_${bookingData.service}`;
            const currentTaken = JSON.parse(localStorage.getItem(storageKey)) || [];
            currentTaken.push(bookingData.time);
            localStorage.setItem(storageKey, JSON.stringify(currentTaken));

            // 2. Preparar Link WhatsApp
            const [ano, mes, dia] = bookingData.date.split('-');
            const msg = `
*Ol√°, gostaria de confirmar um agendamento no Consult√≥rio Olharys!*

üë§ *Paciente:* ${name}
üìç *Cidade:* ${city}
üì± *Telefone:* ${phone}

üë®‚Äç‚öïÔ∏è *Profissional:* ${bookingData.service}
üìÖ *Data:* ${dia}/${mes}/${ano}
‚è∞ *Hor√°rio:* ${bookingData.time}
üí∞ *Valor:* R$ ${bookingData.price},00
            `.trim();

            const encodedMsg = encodeURIComponent(msg);
            const whatsappLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMsg}`;

            // 3. Redirecionar
            window.open(whatsappLink, '_blank');
            
            // Opcional: Recarregar a p√°gina para limpar
            setTimeout(() => {
                alert("Agendamento iniciado! Finalize a conversa no WhatsApp.");
                location.reload();
            }, 1000);
        }
    }
</script>

</body>
</html>
