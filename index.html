<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consult√≥rio Olharys - Agendamento</title>
    <style>
        :root {
            /* === Nova Paleta Moderna Verde √Ågua === */
            --brand-teal: #00a896;       /* Cor principal vibrante */
            --brand-teal-dark: #008c7d;  /* Tom um pouco mais escuro para contrastes */
            --brand-teal-light: #e0f2f1; /* Tom muito claro para fundos de sele√ß√£o */
            
            /* Redefinindo as cores do sistema para usar a nova paleta */
            --primary: var(--brand-teal);
            --secondary: var(--brand-teal-dark);
            
            /* Fundo geral da p√°gina com um tom sutil */
            --background: #f0f7f6; 
            
            --text: #2c3e50;    /* Texto cinza escuro para boa leitura */
            --white: #ffffff;
            --error: #e74c3c;
            --success: #27ae60;
            --disabled: #95a5a6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            /* Usando uma fonte mais moderna se dispon√≠vel */
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--background);
            /* Gradiente sutil no fundo da p√°gina inteira */
            background-image: linear-gradient(to bottom, var(--brand-teal-light) 0%, var(--background) 100%);
            background-attachment: fixed;
            color: var(--text);
            line-height: 1.6;
        }

        /* === Novo Header Moderno === */
        header {
            /* Gradiente impactante na capa */
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-teal-dark));
            padding: 4rem 2rem; /* Mais espa√ßoso */
            text-align: center;
            color: var(--white);
            margin-bottom: 3rem;
            /* Sombra colorida suave */
            box-shadow: 0 10px 20px -10px rgba(0, 168, 150, 0.5);
        }

        header h1 {
            color: var(--white);
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header p {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* === Estilos do Conte√∫do Principal === */
        main {
            max-width: 850px;
            margin: -2rem auto 4rem; /* Sobe um pouco sobre o header */
            padding: 0 1.5rem;
            position: relative;
            z-index: 10;
        }

        .step-container {
            background: var(--white);
            border-radius: 16px; /* Bordas mais arredondadas */
            padding: 2.5rem;
            /* Sombra mais profunda para destacar o cart√£o branco */
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
            border-top: 5px solid var(--brand-teal); /* Detalhe colorido no topo */
            animation: fadeIn 0.6s ease-in-out;
        }

        .step-container.active {
            display: block;
        }

        h2 {
            margin-bottom: 2rem;
            color: var(--secondary);
            font-size: 1.5rem;
            position: relative;
        }
        
        /* Pequeno sublinhado decorativo no t√≠tulo H2 */
        h2::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: var(--brand-teal);
            margin-top: 0.5rem;
            border-radius: 2px;
        }

        /* Passo 1: Sele√ß√£o de Servi√ßo (Cart√µes Melhorados) */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .card {
            background-color: var(--white);
            border: 2px solid transparent; /* Borda transparente por padr√£o */
            border-radius: 12px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .card:hover {
            border-color: var(--brand-teal);
            transform: translateY(-7px); /* Eleva√ß√£o maior no hover */
            box-shadow: 0 12px 20px rgba(0, 168, 150, 0.15); /* Sombra colorida no hover */
        }

        .card.selected {
            border-color: var(--brand-teal);
            /* Usando o tom claro de verde √°gua para o fundo selecionado */
            background-color: var(--brand-teal-light); 
            box-shadow: 0 4px 12px rgba(0, 168, 150, 0.2);
        }
        
        .card h3 {
            color: var(--secondary);
            margin-bottom: 0.5rem;
        }

        .card p {
            color: #666;
            margin-bottom: 1rem;
        }

        .price {
            display: inline-block;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--white);
            background-color: var(--brand-teal);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            margin-top: 1rem;
        }
        
        /* Quando selecionado, o pre√ßo muda para combinar com o fundo claro */
        .card.selected .price {
             background-color: var(--brand-teal-dark);
        }

        /* Passo 2: Calend√°rio e Hor√°rios */
        .form-group {
            margin-bottom: 2rem;
        }

        label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 600;
            color: var(--secondary);
        }

        input[type="date"], input[type="text"], input[type="tel"] {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            background-color: #fcfcfc;
        }
        
        input:focus {
            outline: none;
            border-color: var(--brand-teal);
            background-color: var(--white);
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .time-slot {
            padding: 0.8rem 0.5rem;
            background: var(--white);
            border: 2px solid var(--brand-teal-light);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            color: var(--brand-teal-dark);
            font-weight: 600;
            transition: all 0.2s;
        }

        .time-slot:hover:not(.disabled) {
            background: var(--brand-teal);
            color: var(--white);
            border-color: var(--brand-teal);
            transform: scale(1.05);
        }

        .time-slot.selected {
            background: var(--brand-teal);
            color: var(--white);
            border-color: var(--brand-teal-dark);
            box-shadow: 0 4px 10px rgba(0, 168, 150, 0.3);
        }

        .time-slot.disabled {
            background-color: #f1f5f9;
            border-color: #e2e8f0;
            color: var(--disabled);
            cursor: not-allowed;
            text-decoration: line-through;
            opacity: 0.7;
        }

        /* Bot√µes */
        .btn-group {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid #eee;
        }

        button {
            padding: 0.9rem 2rem;
            border: none;
            border-radius: 50px; /* Bot√µes arredondados */
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: all 0.3s;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        button:hover {
             transform: translateY(-2px);
             box-shadow: 0 7px 14px rgba(0,0,0,0.15);
        }

        .btn-next {
            background: linear-gradient(to right, var(--brand-teal), var(--brand-teal-dark));
            color: var(--white);
        }
        
        .btn-next:hover {
             filter: brightness(110%);
        }

        .btn-back {
            background-color: #fff;
            color: #7f8c8d;
            border: 2px solid #bdc3c7;
            box-shadow: none;
        }
        
        .btn-back:hover {
             background-color: #f9f9f9;
             border-color: #95a5a6;
             color: #34495e;
        }

        /* Mensagens de Erro */
        .error-msg {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 0.8rem;
            display: none;
            font-weight: 500;
            padding: 0.5rem;
            background-color: #fff5f5;
            border-radius: 4px;
            border-left: 4px solid var(--error);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Resumo final */
        .summary-box {
            background: var(--brand-teal-light);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 2px solid var(--brand-teal);
        }
        .summary-item {
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed rgba(0, 168, 150, 0.3);
            padding-bottom: 0.5rem;
        }
        .summary-item:last-child {
            border-bottom: none;
        }
        .summary-label {
            font-weight: 600;
            color: var(--brand-teal-dark);
        }
        .summary-value {
             font-weight: 700;
             color: var(--text);
        }

    </style>
</head>
<body>

<header>
    <h1>Consult√≥rio Olharys</h1>
    <p>Sua vis√£o √© a nossa prioridade. Agende sua consulta com excel√™ncia.</p>
</header>

<main>
    <div id="step1" class="step-container active">
        <h2>1. Escolha o Profissional</h2>
        <p style="margin-bottom: 2rem; color: #666;">Selecione o tipo de atendimento que voc√™ precisa hoje:</p>
        <div class="service-grid">
            <div class="card" onclick="selectService('Optometrista', 120, this)">
                <h3>Optometrista</h3>
                <p>Exame de vista completo para prescri√ß√£o de √≥culos e lentes.</p>
                <span class="price">A partir de R$ 120,00</span>
            </div>
            <div class="card" onclick="selectService('Oftalmologista', 150, this)">
                <h3>Oftalmologista</h3>
                <p>Avalia√ß√£o m√©dica da sa√∫de ocular, diagn√≥sticos e tratamentos.</p>
                <span class="price">A partir de R$ 150,00</span>
            </div>
        </div>
        <div class="error-msg" id="error-step1">Por favor, clique em um dos cart√µes acima para selecionar.</div>
        <div class="btn-group" style="justify-content: flex-end;">
            <button class="btn-next" onclick="goToStep(2)">Continuar Agendamento</button>
        </div>
    </div>

    <div id="step2" class="step-container">
        <h2>2. Data e Hor√°rio (2026)</h2>
        <div class="form-group">
            <label for="dateInput">Selecione a melhor data para voc√™:</label>
            <input type="date" id="dateInput" min="2026-01-01" max="2026-12-31">
            <div class="error-msg" id="date-error"></div>
        </div>

        <div id="timeContainer" style="display:none;">
            <label style="margin-bottom: 0;">Hor√°rios dispon√≠veis:</label>
            <p style="font-size: 0.95em; color: #7f8c8d; margin-bottom: 1.5rem;">Atendimento das 08:00 √†s 18:00 (Intervalo de almo√ßo das 12h √†s 14h)</p>
            <div class="time-grid" id="timeGrid">
                </div>
            <div class="error-msg" id="time-error">Por favor, clique em um hor√°rio dispon√≠vel.</div>
        </div>

        <div class="btn-group">
            <button class="btn-back" onclick="goToStep(1)">‚Üê Voltar</button>
            <button class="btn-next" onclick="goToStep(3)">Continuar ‚Üí</button>
        </div>
    </div>

    <div id="step3" class="step-container">
        <h2>3. Seus Dados e Confirma√ß√£o</h2>
        
        <div class="summary-box">
            <h3 style="color: var(--brand-teal-dark); margin-bottom: 1rem;">Resumo do Agendamento</h3>
            <div class="summary-item">
                <span class="summary-label">Profissional:</span> <span class="summary-value" id="sum-pro"></span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Data:</span> <span class="summary-value" id="sum-date"></span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Hor√°rio:</span> <span class="summary-value" id="sum-time"></span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Valor Estimado:</span> <span class="summary-value" style="color: var(--brand-teal-dark); font-size: 1.2em;" id="sum-price"></span>
            </div>
        </div>

        <p style="margin-bottom: 1.5rem; font-weight: 600;">Preencha seus dados para finalizar:</p>

        <div class="form-group">
            <label for="name">Nome Completo</label>
            <input type="text" id="name" placeholder="Ex: Jo√£o da Silva">
        </div>
        <div class="form-group">
            <label for="city">Cidade</label>
            <input type="text" id="city" placeholder="Ex: Maring√°">
        </div>
        <div class="form-group">
            <label for="phone">Telefone (WhatsApp)</label>
            <input type="tel" id="phone" placeholder="(XX) 9XXXX-XXXX">
        </div>

        <div class="error-msg" id="form-error">Por favor, preencha todos os campos obrigat√≥rios.</div>

        <div class="btn-group">
            <button class="btn-back" onclick="goToStep(2)">‚Üê Voltar</button>
            <button class="btn-next" onclick="finishBooking()">Concluir Agendamento via WhatsApp</button>
        </div>
    </div>
</main>

<script>
    // --- Configura√ß√µes e Dados ---
    const WHATSAPP_NUMBER = "5544991837620"; // C√≥digo pa√≠s + DDD + N√∫mero
    const YEAR = 2026;
    
    // Feriados Nacionais 2026 (Formato YYYY-MM-DD)
    const HOLIDAYS_2026 = [
        "2026-01-01", // Confraterniza√ß√£o Universal
        "2026-02-17", // Carnaval (Opcional, mas comum fechar)
        "2026-04-03", // Sexta-feira Santa
        "2026-04-21", // Tiradentes
        "2026-05-01", // Dia do Trabalho
        "2026-06-04", // Corpus Christi
        "2026-09-07", // Independ√™ncia do Brasil
        "2026-10-12", // Nossa Sra. Aparecida
        "2026-11-02", // Finados
        "2026-11-15", // Proclama√ß√£o da Rep√∫blica
        "2026-12-25"  // Natal
    ];

    // Estado da aplica√ß√£o
    let bookingData = {
        service: null,
        price: null,
        date: null,
        time: null,
        patientName: null,
        city: null,
        phone: null
    };

    // --- L√≥gica de Inicializa√ß√£o ---
    document.addEventListener('DOMContentLoaded', () => {
        // Define limites do input date
        const dateInput = document.getElementById('dateInput');
        dateInput.min = `${YEAR}-01-01`;
        dateInput.max = `${YEAR}-12-31`;

        dateInput.addEventListener('change', handleDateChange);
        
        // M√°scara simples para telefone (opcional, melhora UX)
        document.getElementById('phone').addEventListener('input', function (e) {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });
    });

    // --- Navega√ß√£o entre Passos ---
    function goToStep(stepNumber) {
        // Valida√ß√µes antes de avan√ßar
        if (stepNumber === 2) {
            if (!bookingData.service) {
                document.getElementById('error-step1').style.display = 'block';
                // Scroll para o erro
                document.getElementById('error-step1').scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }
            document.getElementById('error-step1').style.display = 'none';
        }

        if (stepNumber === 3) {
            if (!bookingData.date || !bookingData.time) {
                // Se tentar avan√ßar sem data/hora, mostra os erros nos campos respectivos
                if(!bookingData.date) document.getElementById('date-error').innerText = "Selecione uma data.";
                if(bookingData.date && !bookingData.time) document.getElementById('time-error').style.display = 'block';
                return;
            }
            updateSummary();
        }

        // Troca de abas com scroll suave para o topo do container
        document.querySelectorAll('.step-container').forEach(el => el.classList.remove('active'));
        const nextStep = document.getElementById(`step${stepNumber}`);
        nextStep.classList.add('active');
        nextStep.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // --- Passo 1: Sele√ß√£o de Servi√ßo ---
    function selectService(name, price, element) {
        bookingData.service = name;
        bookingData.price = price;
        document.getElementById('error-step1').style.display = 'none';
        
        // Visual
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
        element.classList.add('selected');
        
        // Resetar hor√°rio se mudar servi√ßo
        bookingData.time = null;
        // Se j√° estiver na tela 2, atualiza os slots
        if(document.getElementById('step2').classList.contains('active') && bookingData.date) {
             renderTimeSlots();
        }
    }

    // --- Passo 2: L√≥gica de Calend√°rio ---
    function handleDateChange(e) {
        const selectedDate = e.target.value;
        if (!selectedDate) return; // Se o usu√°rio limpar o campo

        const dateObj = new Date(selectedDate + 'T00:00:00');
        const dayOfWeek = dateObj.getDay(); // 0 = Dom, 6 = Sab
        const errorDiv = document.getElementById('date-error');
        const timeContainer = document.getElementById('timeContainer');

        bookingData.date = null;
        bookingData.time = null; // Reseta hor√°rio ao mudar data
        timeContainer.style.display = 'none';
        errorDiv.style.display = 'none';
        errorDiv.innerText = '';

        // 1. Validar Ano
        if (dateObj.getFullYear() !== YEAR) {
            errorDiv.innerText = `Agendamentos permitidos apenas para o ano de ${YEAR}.`;
            errorDiv.style.display = 'block';
            return;
        }

        // 2. Validar Fim de Semana
        if (dayOfWeek === 0 || dayOfWeek === 6) {
            errorDiv.innerText = "Nosso consult√≥rio n√£o abre aos s√°bados e domingos.";
            errorDiv.style.display = 'block';
            return;
        }

        // 3. Validar Feriados
        if (HOLIDAYS_2026.includes(selectedDate)) {
            errorDiv.innerText = "N√£o haver√° atendimento neste feriado nacional.";
            errorDiv.style.display = 'block';
            return;
        }

        // Data v√°lida
        bookingData.date = selectedDate;
        timeContainer.style.display = 'block';
        // Pequeno delay para a anima√ß√£o do container aparecer antes de renderizar os slots
        setTimeout(renderTimeSlots, 100);
    }

    function renderTimeSlots() {
        const grid = document.getElementById('timeGrid');
        grid.innerHTML = '';
        document.getElementById('time-error').style.display = 'none';

        if (!bookingData.date || !bookingData.service) {
             grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">Selecione um profissional e uma data primeiro.</p>';
             return;
        }
        
        // Hor√°rios dispon√≠veis (pulando 12h e 13h)
        const slots = [
            "08:00", "09:00", "10:00", "11:00", 
            "14:00", "15:00", "16:00", "17:00"
        ];

        // Recuperar agendamentos
        const storageKey = `${bookingData.date}_${bookingData.service}`;
        const takenSlots = JSON.parse(localStorage.getItem(storageKey)) || [];

        slots.forEach(time => {
            const div = document.createElement('div');
            div.className = 'time-slot';
            div.innerText = time;

            if (takenSlots.includes(time)) {
                div.classList.add('disabled');
                div.title = "Este hor√°rio j√° foi reservado.";
            } else {
                div.onclick = () => selectTime(time, div);
                // Marca se j√° estava selecionado antes
                if (bookingData.time === time) div.classList.add('selected');
            }

            grid.appendChild(div);
        });
    }

    function selectTime(time, element) {
        if (element.classList.contains('disabled')) return;

        bookingData.time = time;

        // Visual
        document.querySelectorAll('.time-slot').forEach(t => t.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('time-error').style.display = 'none';
    }

    // --- Passo 3: Finaliza√ß√£o ---
    function updateSummary() {
        // Formatar data para exibi√ß√£o brasileira
        const [ano, mes, dia] = bookingData.date.split('-');
        const dataFormatada = `${dia}/${mes}/${ano}`;

        document.getElementById('sum-pro').innerText = bookingData.service;
        document.getElementById('sum-date').innerText = dataFormatada;
        document.getElementById('sum-time').innerText = bookingData.time + ' h';
        document.getElementById('sum-price').innerText = `R$ ${bookingData.price},00`;
        
        // Limpa erro do formul√°rio se houver
        document.getElementById('form-error').style.display = 'none';
    }

    function finishBooking() {
        const name = document.getElementById('name').value.trim();
        const city = document.getElementById('city').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const errorDiv = document.getElementById('form-error');

        if (!name || !city || !phone || phone.length < 10) {
            errorDiv.innerText = "Por favor, preencha nome, cidade e um telefone v√°lido.";
            errorDiv.style.display = 'block';
            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return;
        }

        // Confirma√ß√£o final visual (usando o pr√≥prio navegador por simplicidade)
        if (confirm(`Confirmar agendamento para ${bookingData.date} √†s ${bookingData.time}? Voc√™ ser√° redirecionado para o WhatsApp.`)) {
            
            // 1. Salvar Bloqueio no LocalStorage
            const storageKey = `${bookingData.date}_${bookingData.service}`;
            const currentTaken = JSON.parse(localStorage.getItem(storageKey)) || [];
            currentTaken.push(bookingData.time);
            localStorage.setItem(storageKey, JSON.stringify(currentTaken));

            // 2. Preparar Link WhatsApp com formata√ß√£o melhorada
            const [ano, mes, dia] = bookingData.date.split('-');
            const msg = `
Ol√°! Gostaria de confirmar o seguinte agendamento no *Consult√≥rio Olharys*:

====================
‚úÖ *DADOS DO AGENDAMENTO*
====================
üë®‚Äç‚öïÔ∏è *Profissional:* ${bookingData.service}
üìÖ *Data:* ${dia}/${mes}/${ano}
‚è∞ *Hor√°rio:* ${bookingData.time}
üí∞ *Valor Estimado:* R$ ${bookingData.price},00

====================
üë§ *DADOS DO PACIENTE*
====================
*Nome:* ${name}
*Cidade:* ${city}
*Telefone:* ${phone}

Aguardo a confirma√ß√£o. Obrigado!
            `.trim();

            const encodedMsg = encodeURIComponent(msg);
            // Usando wa.me api que funciona bem em mobile e desktop
            const whatsappLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMsg}`;

            // 3. Redirecionar em nova aba
            window.open(whatsappLink, '_blank');
            
            // Feedback e reset
            document.getElementById('step3').innerHTML = `
                <div style="text-align:center; padding: 3rem;">
                    <h2 style="color: var(--success); margin-bottom:1rem;">Agendamento Iniciado!</h2>
                    <p style="font-size:1.2rem; color:#555;">Por favor, conclua o envio da mensagem na janela do WhatsApp que foi aberta.</p>
                    <button class="btn-next" style="margin-top:2rem;" onclick="location.reload()">Fazer Novo Agendamento</button>
                </div>
            `;
        }
    }
</script>

</body>
</html>
